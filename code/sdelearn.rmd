---
title: "Statistical analysis report"
subtitle: "SD e-Learning"
author: "Nartlada Chantharojwong"
date: "`r Sys.Date()`"
output:
  word_document:
    reference_docx: word-styles-reference-01.docx
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  cache = FALSE
)

# Packages
source(here::here('code', 'libraries.R'))

# Functions
source(here::here('code', 'functions.R'))
source(here::here('code', "render_toc.R"))

# Theme for gtsummary output
theme_gtsummary_compact()
```

\newpage

### Table of Contents

```{r toc, echo=FALSE}
render_toc(here::here('code', "sdelearn.rmd"))
```

```{r data}
df <- import(here('data', 'data.xlsx')) %>%
  clean_names() %>%
  mutate(
    quniv = factor(
      quniv,
      levels = c('กรมแพทย์ทหารบก (วิทยาลัยแพทยศาสตร์พระมงกุฎเกล้า/วิทยาลัยพยาบาลกองทัพบก)','คณะแพทยศาสตร์ โรงพยาบาลรามาธิบดี มหาวิทยาลัยมหิดล'),
      labels = c('Pramongkutklao Hospital','Ramathibodi Hospital')
    ),
    qtype = factor(
      qtype,
      levels = c('นักศึกษาแพทย์', 'นักศึกษาพยาบาล'),
      labels = c('Medical', 'Nurse')
    ),
    qyearf = factor(
      if_else(qtype == "Medical",
        cut(qyear, 
            breaks = c(0, 5, 6), 
            labels = c("Early clinical years", "Final clinical year"), 
            right = TRUE),
        cut(qyear, 
            breaks = c(0, 3, 4), 
            labels = c("Early clinical years", "Final clinical year"), 
            right = TRUE)
      ),
      # levels = c("Final clinical year", "Early clinical years")
    ),
    qyear = factor(
      ifelse(qyear == 2, 3, qyear),
      levels = c(3,4,5,6),
      labels = c('3rd', '4th', '5th', '6th')
    ),
    agegrp = cut(
      q11,
      breaks = c(0, 20, Inf),
      labels = c('<= 20 years', '> 20 years'),
    ),
    q12 = factor(
      q12,
      levels = c('ชาย', 'หญิง', 'ไม่ระบุ'),
      labels = c('Male', 'Female', 'Not specified')
    ),
    q13a = factor(
      q13,
      levels = c(
        'กรุงเทพและปริมณฑล',
        'ภาคเหนือ',
        'ภาคกลาง',
        'ภาคตะวันออก',
        'ภาคตะวันออกเฉียงเหนือ',
        'ภาคตะวันตก',
        'ภาคใต้',
        NA
      ),
      labels = c(
        'Bangkok and perimeters',
        'North',
        'Central',
        'East',
        'Northeast',
        'West',
        'South',
        'Not specified'
      ),
      exclude = NULL
    ),
    q13b = factor(
      q13,
      levels = c(
        'กรุงเทพและปริมณฑล',
        'ภาคเหนือ',
        'ภาคกลาง',
        'ภาคตะวันออก',
        'ภาคตะวันออกเฉียงเหนือ',
        'ภาคตะวันตก',
        'ภาคใต้',
        NA
      ),
      labels = c(
        'Bangkok and perimeters',
        'Central & North',
        'Central & North',
        'East & Northeast',
        'East & Northeast',
        'West & South',
        'West & South',
        'Not specified'
      ),
      exclude = NULL
    ),
    
    q21 = factor(
      q21,
      levels = c('เคย', 'ไม่เคย'),
      labels = c('Yes', 'No')),
    across(num_range('q21', 1:4), ~ factor(
      .x,
      levels = c('ใช่', 'ไม่ใช่'),
      labels = c('Yes', 'No')
    )),
    
    across(c('q221', 'q231', 'q241', 'q26', 'q27'), worry_score, .names = "{col}_score"),
    across(c('q221', 'q231', 'q241', 'q26', 'q27'), ~ factor(
      .x,
      levels = c('ไม่กังวลเลย', 'กังวลเล็กน้อย', 'ค่อนข้างกังวล', 'กังวลมาก'),
      labels = c(
        'Not at all worried - 1',
        'A little worried - 2',
        'Somewhat worried - 3',
        'Very worried - 4'
      )
    )),
    sum2a_score = rowSums(across(q221_score:q241_score), na.rm = TRUE),
    sum2b_score = rowSums(across(q26_score:q27_score), na.rm = TRUE),

    q25 = factor(
      q25,
      levels = c('เคย', 'ไม่เคย', 'อาจจะ, ไม่แน่ใจ'),
      labels = c('Yes', 'No', 'Not sure')
    ),

    across(matches("^q3([1-9]|10)1$"), worry_score, .names = "{col}_score"),
    across(matches("^q3([1-9]|10)1$"), ~ factor(
      .x,
      levels = c('ไม่กังวลเลย', 'กังวลเล็กน้อย', 'ค่อนข้างกังวล', 'กังวลมาก'),
      labels = c(
        'Not at all worried - 1',
        'A little worried - 2',
        'Somewhat worried - 3',
        'Very worried - 4'
      )
    )),
    sum3a_score = rowSums(across(c(q311_score:q3101_score)), na.rm = TRUE),
    sum3ai_score = rowSums(across(c(q311_score:q341_score, 'q361_score', q381_score:q3101_score)), na.rm = TRUE),

    across(matches("^q3([1-9]|10)2$"), ~ if_else(grepl('^ฉันจะทำ แต่ทำโดยป้องกันเป็นพิเศษมากกว่าการป้องกันตามปกติ',.x),'ฉันจะทำ แต่ทำโดยป้องกันเป็นพิเศษมากกว่าการป้องกันตามปกติ',.x)),
    across(matches("^q3([1-9]|10)2$"), intent_score, .names = "{col}_score"),
    across(matches("^q3([1-9]|10)2$"), intent_score2, .names = "{col}_score2"),
    across(matches("^q3([1-9]|10)2$"), ~ factor(
      .x,
      levels = c(
        'ฉันจะทำเหมือนกับที่ฉันทำให้ผู้ป่วยรายอื่น ๆ',
        'ฉันจะทำ แต่ทำโดยป้องกันเป็นพิเศษมากกว่าการป้องกันตามปกติ',
        'ฉันจะทำ แต่ฉันจะหลีกเลี่ยงการสัมผัสผู้ป่วยให้มากที่สุด',
        'ฉันจะปฏิเสธ หรือพยายามหาคนอื่นทำแทน'
      ),
      labels = c(
        'Do as I would with any other - 1',
        'Do, with extra-precaution - 2',
        'Do, but avoid touching - 3',
        'Refused - 4'
      )
    )),
    sum3b_score = rowSums(across(c(q312_score:q3102_score)), na.rm = TRUE),
    q3b = cut(
      rowMeans(across(c(q312_score:q342_score, 'q362_score', q382_score:q3102_score)), na.rm = TRUE),
      breaks = c(0, 2, Inf),
      labels = c('Score < 2','Score >= 2'),
      right = FALSE
    ),

    q42_score = norm_score(q42),
    across(q43:q47, norm_score_rev, .names = "{col}_score"),
    q42 = factor(
      q42,
      levels = c('ทั้งหมด', 'ส่วนใหญ่', 'บางคน', 'ไม่มี'),
      labels = c(
        'All - 1',
        'Most - 2',
        'Some - 3',
        'No one - 4'
      )
    ),
    across(q43:q47, ~ factor(
      .x,
      levels = c('ไม่มี', 'บางคน', 'ส่วนใหญ่', 'ทั้งหมด'),
      labels = c(
        'No one - 1',
        'Some - 2',
        'Most - 3',
        'All - 4'
      )
    )),
    sum4_score = rowSums(across(q42_score:q47_score), na.rm = TRUE),
    
    across(c('q51', q54:q55, q59, q513:q518, q520:q522), agree_score_rev, .names = "{col}_score"),
    across(c(q52:q53, q56:q58, q510:q512, 'q519', 'q523'), agree_score, .names = "{col}_score"),
    across(
      c(q51:q523), 
      ~ factor(
        .x,
        levels = c(
          'เห็นด้วยอย่างยิ่ง',
          'ค่อนข้างเห็นด้วย',
          'ไม่ค่อยเห็นด้วย',
          'ไม่เห็นด้วยอย่างยิ่ง'
        ),
        labels = c('Agree', 'Agree', 'Disagree', 'Disagree')
      ),
      .names = "{col}_2"
    ),
    across(c('q51', q54:q55, q59, q513:q518, q520:q522), ~ factor(
      .x,
      levels = c(
        'ไม่เห็นด้วยอย่างยิ่ง',
        'ไม่ค่อยเห็นด้วย',
        'ค่อนข้างเห็นด้วย',
        'เห็นด้วยอย่างยิ่ง'
      ),
      labels = c(
        'Strongly disagree - 1',
        'Disagree - 2',
        'Agree - 3',
        'Strongly agree - 4'
      )
    )),
    across(c(q52:q53, q56:q58, q510:q512, 'q519', 'q523'), ~ factor(
      .x,
      levels = c(
        'เห็นด้วยอย่างยิ่ง',
        'ค่อนข้างเห็นด้วย',
        'ไม่ค่อยเห็นด้วย',
        'ไม่เห็นด้วยอย่างยิ่ง'
      ),
      labels = c(
        'Strongly agree - 1',
        'Agree - 2',
        'Disagree - 3',
        'Strongly disagree - 4'
      )
    )),
    sum5a_score = rowSums(across(matches("^q5([1-9]|1[0-9])_score$")), na.rm = TRUE),
    sum5b_score = rowSums(across(matches("^q5(2[0-3])_score$")), na.rm = TRUE),
    q5a = cut(
      rowMeans(
        across(matches("^q5([1-9]|1[0-9])_score$")),
        na.rm = TRUE
      ),
      breaks = c(0, 2, Inf),
      labels = c('Score <= 2','Score > 2'),
      right = TRUE
    ),
    
    across(q61:q68, comfort_score, .names = "{col}_score"),
    across(q61:q68, ~ factor(
      .x,
      levels = c(
        'ไม่สะดวกใจมาก',
        'ค่อนข้างไม่สะดวกใจ',
        'ค่อนข้างสะดวกใจ',
        'สะดวกใจมาก'),
      labels = c(
        'Very uncomfortable - 4',
        'Somewhat uncomfortable - 3',
        'Somewhat comfortable - 2',
        'Very comfortable - 1'
      )
    )),
    sum6_score = rowSums(across(q61_score:q68_score), na.rm = TRUE),
    
    across(c('q71','q72','q74','q78','q79'), tf_score, .names = "{col}_score"),
    across(c('q73','q75','q76','q77'), tf_score_rev, .names = "{col}_score"),
    across(c('q71','q72','q74','q78','q79'), ~ factor(
      .x,
      levels = c(
        'ถูก',
        'ผิด'),
      labels = c(
        'True - 1',
        'False - 0'
      )
    )),
    across(c('q73','q75','q76','q77'), ~ factor(
      .x,
      levels = c(
        'ถูก',
        'ผิด'),
      labels = c(
        'True - 0',
        'False - 1'
      )
    )),
    sum7_score = rowSums(across(matches("^q7([1-9])_score$")), na.rm = TRUE),
    
    across(c(q81:q83,q85:q810), tf_score, .names = "{col}_score"),
    across(c('q84','q811'), tf_score_rev, .names = "{col}_score"),
    across(c(q81:q83,q85:q810), ~ factor(
      .x,
      levels = c(
        'ถูก',
        'ผิด'),
      labels = c(
        'True - 1',
        'False - 0'
      )
    )),
    across(c('q84','q811'), ~ factor(
      .x,
      levels = c(
        'ถูก',
        'ผิด'),
      labels = c(
        'True - 0',
        'False - 1'
      )
    )),
    sum8a_score = rowSums(across(matches("^q8([1-9]|1[0-1])_score$")), na.rm = TRUE),
    
    across(q812:q816, important_score, .names = "{col}_score"),
    across(q812:q816, ~ factor(
      .x,
      levels = c(
        'สำคัญมาก',
        'ค่อนข้างสำคัญ',
        'ไม่ค่อยสำคัญ',
        'ไม่สำคัญเลย'
       ),
      labels = c(
        'Very important - 4',
        'Somewhat important - 3',
        'Not very important - 2',
        'Not important at all - 1'
      )
    )),
    sum8b_score = rowSums(across(q812_score:q816_score), na.rm = TRUE),
    q8b = if_else(if_all(q812_score:q816_score, ~ .x == 4), 1, 0, missing = 0),
    sum8_score = rowSums(across(q81_score:q811_score), na.rm = TRUE) + q8b,
    
    across(q91:q97, certain_score_rev, .names = "{col}_score"),
    across(q91:q97, ~ factor(
      .x,
      levels = c(
        'มั่นใจมาก',
        'ค่อนข้างมั่นใจ',
        'ไม่ค่อยมั่นใจ',
        'ไม่มั่นใจ'
      ),
      labels = c(
        'Very certain - 4',
        'Somewhat certain - 3',
        'Somewhat uncertain - 2',
        'Very uncertain - 1'
      )
    )),
    sum9_score = rowSums(across(q91_score:q97_score), na.rm = TRUE),
    
    across(q101:q107, confidence_score, .names = "{col}_score"),
    across(q101:q107, ~ factor(
      .x,
      levels = c(
        'ทำได้แน่นอน',
        'คิดว่าทำได้',
        'คิดว่าทำไม่ได้',
        'ทำไม่ได้เลย'),
      labels = c(
        'I definitely can - 4',
        'I think I can - 3',
        'Don\'t think I can - 2',
        'I definitely cannot - 1'
      )
    )),
    sum10_score = rowSums(across(q101_score:q107_score), na.rm = TRUE),
  ) %>%
  set_variable_labels(
    quniv = 'University',
    qtype = 'Type',
    qyear = 'Year of study',
    qyearf = 'Year of study (early or final clinical year)',
    q11 = 'Age (years)',
    agegrp = 'Age group',
    q12 = 'Gender',
    q13a = 'Place of origin (Region)',
    q13b = 'Place of origin (Region)',
    q21 = '2.1 Have you ever contacted/taken care of HIV patients?',
    q211 = '2.1.1 Wear double gloves when taking care PLHIV',
    q212 = '2.1.2 Wear double gloves when taking care other patients',
    q213 = '2.1.3 Use special infection control when taking care PLHIV',
    q214 = '2.1.4 Use special infection control when taking care other patients',
    q221 = '2.2.1 Worried would you be about getting HIV infection if you have to touch the clothing, bedding or belongings',
    q231 = '2.3.1 Worried would you be about getting HIV infection if you have to dress the wounds of HIV/AIDS patients',
    q241 = '2.4.1 Worried would you be about getting HIV infection if you have to draw blood',
    q25 = '2.5 Have you ever been tested for HIV?',
    q26 = '2.6 If you were tested, how worried were you that you might be treated differently or discriminated against if you were to test positive',
    q27 = '2.7 If your test was positive, how worried were you that you might be treated differently or discriminated against if you were to test positive',
    q221_score = 'Score',
    q231_score = 'Score',
    q241_score = 'Score',
    q26_score = 'Score',
    q27_score = 'Score',
    sum2a_score = 'Total score',
    sum2b_score = 'Total score',
    q311 = "3.1 drawing blood",
    q321 = "3.2 starting an IV",
    q331 = "3.3 dressing wound",
    q341 = "3.4 assisting in OR, LR",
    q351 = "3.5 performing chest auscultation",
    q361 = "3.6 performing /assisting in ascetic tap",
    q371 = "3.7 taking blood pressure",
    q381 = "3.8 Administering an injection",
    q391 = "3.9 performing /assisting lumbar puncture",
    q3101 = "3.10 doing urine catheterization",
    q311_score = 'Score',
    q321_score = 'Score',
    q331_score = 'Score',
    q341_score = 'Score',
    q351_score = 'Score',
    q361_score = 'Score',
    q371_score = 'Score',
    q381_score = 'Score',
    q391_score = 'Score',
    q3101_score = 'Score',
    sum3a_score = 'Total score',
    sum3ai_score = 'Worried about performing invasive procedures',
    q312 = "3.1 drawing blood",
    q322 = "3.2 starting an IV",
    q332 = "3.3 dressing wound",
    q342 = "3.4 assisting in OR, LR",
    q352 = "3.5 performing chest auscultation",
    q362 = "3.6 performing /assisting in ascetic tap",
    q372 = "3.7 taking blood pressure",
    q382 = "3.8 Administering an injection",
    q392 = "3.9 performing /assisting lumbar puncture",
    q3102 = "3.10 doing urine catheterization",
    q312_score = 'Score',
    q322_score = 'Score',
    q332_score = 'Score',
    q342_score = 'Score',
    q352_score = 'Score',
    q362_score = 'Score',
    q372_score = 'Score',
    q382_score = 'Score',
    q392_score = 'Score',
    q3102_score = 'Score',
    sum3b_score = 'Total score',
    q3b = 'Intention to discriminate while performing invasive procedures',
    # q41 = '4.1 How many would share dishes or glasses with a person with HIV?',
    q42 = '4.2 How many would be comfortable having a person with HIV cooking for them?',
    q43 = '4.3 How many would avoid visiting the homes of people with HIV?',
    q44 = '4.4 How many think that if someone has HIV. It’s due to having engaged in bad behaviors',
    q45 = '4.5 How many think that people with HIV deserve their disease',
    q46 = '4.6 How many think that people with HIV should feel guilty about their infection',
    q47 = '4.7 How many think that people with HIV have brought shame upon their families',
    q42_score = 'Score',
    q43_score = 'Score',
    q44_score = 'Score',
    q45_score = 'Score',
    q46_score = 'Score',
    q47_score = 'Score',
    sum4_score = 'Total score',
    q51 = '5.1 Healthcare workers should be able to refuse to treat a person with HIV.',
    q52 = '5.2 People with HIV should have the right to decide whether or not to disclose their HIV status to their healthcare providers.',
    q53 = '5.3 Employers should not be able to fire a worker living with HIV.',
    q54 = '5.4 Women with the HIV infection should NOT be allowed to marry.',
    q55 = '5.5 Men with the HIV infection should NOT be allowed to marry.',
    q56 = '5.6 A landlord should not have the right to refuse to rent a room to a person with HIV.',
    q57 = '5.7 A man with HIV should have the right to decide whether or not to disclose his HIV status to his wife.',
    q58 = '5.8 A woman with HIV should have the right to decide whether or not to disclose her HIV status to her husband.',
    q59 = '5.9 All female sex workers should be required to be tested for HIV.',
    q510 = '5.10 Women with HIV should have the right to have children.',
    q511 = '5.11 People with HIV should have the right to decide whether or not to disclose their HIV status to their family (other than their spouse).',
    q512 = '5.12 Children with HIV should have the right to attend school.',
    q513 = '5.13 All patients undergoing surgery should be required to be tested for HIV.',
    q514 = '5.14 All medical personnel who perform surgery should be required to be tested for HIV regularly.',
    q515 = '5.15 A patient who has HIV should have a clearly visible label on their medical files, identifying their infection.',
    q516 = '5.16 Other patients in the ward have the right to know if a patient is infected with HIV.',
    q517 = '5.17 PLHIV should only have the right to marry other PLHIV.',
    q518 = '5.18 Blood test for HIV without a patient acknowledgement or consent is acceptable.',
    q519 = '5.19 There are adequate supplies in the hospital where you train to help reduce your risk of becoming infected with HIV.',
    q520 = '5.20 Most of PLHIV do not care that they could infect other people.',
    q521 = '5.21 PLHIV should be shamed about their HIV status.',
    q522 = '5.22 People get infected with HIV because they engage in irresponsible or immoral behaviors.',
    q523 = '5.23 Women living with HIV should be allowed to have babies if they wish.',
    q51_2 = '5.1 Healthcare workers should be able to refuse to treat a person with HIV.',
    q52_2 = '5.2 People with HIV should have the right to decide whether or not to disclose their HIV status to their healthcare providers.',
    q53_2 = '5.3 Employers should not be able to fire a worker living with HIV.',
    q54_2 = '5.4 Women with the HIV infection should NOT be allowed to marry.',
    q55_2 = '5.5 Men with the HIV infection should NOT be allowed to marry.',
    q56_2 = '5.6 A landlord should not have the right to refuse to rent a room to a person with HIV.',
    q57_2 = '5.7 A man with HIV should have the right to decide whether or not to disclose his HIV status to his wife.',
    q58_2 = '5.8 A woman with HIV should have the right to decide whether or not to disclose her HIV status to her husband.',
    q59_2 = '5.9 All female sex workers should be required to be tested for HIV.',
    q510_2 = '5.10 Women with HIV should have the right to have children.',
    q511_2 = '5.11 People with HIV should have the right to decide whether or not to disclose their HIV status to their family (other than their spouse).',
    q512_2 = '5.12 Children with HIV should have the right to attend school.',
    q513_2 = '5.13 All patients undergoing surgery should be required to be tested for HIV.',
    q514_2 = '5.14 All medical personnel who perform surgery should be required to be tested for HIV regularly.',
    q515_2 = '5.15 A patient who has HIV should have a clearly visible label on their medical files, identifying their infection.',
    q516_2 = '5.16 Other patients in the ward have the right to know if a patient is infected with HIV.',
    q517_2 = '5.17 PLHIV should only have the right to marry other PLHIV.',
    q518_2 = '5.18 Blood test for HIV without a patient acknowledgement or consent is acceptable.',
    q519_2 = '5.19 There are adequate supplies in the hospital where you train to help reduce your risk of becoming infected with HIV.',
    q520_2 = '5.20 Most of PLHIV do not care that they could infect other people.',
    q521_2 = '5.21 PLHIV should be shamed about their HIV status.',
    q522_2 = '5.22 People get infected with HIV because they engage in irresponsible or immoral behaviors.',
    q523_2 = '5.23 Women living with HIV should be allowed to have babies if they wish.',
    q51_score = 'Score',
    q52_score = 'Score',
    q53_score = 'Score',
    q54_score = 'Score',
    q55_score = 'Score',
    q56_score = 'Score',
    q57_score = 'Score',
    q58_score = 'Score',
    q59_score = 'Score',
    q510_score = 'Score',
    q511_score = 'Score',
    q512_score = 'Score',
    q513_score = 'Score',
    q514_score = 'Score',
    q515_score = 'Score',
    q516_score = 'Score',
    q517_score = 'Score',
    q518_score = 'Score',
    q519_score = 'Score',
    q520_score = 'Score',
    q521_score = 'Score',
    q522_score = 'Score',
    q523_score = 'Score',
    sum5a_score ='Total score',
    sum5b_score = 'Total score',
    q5a = 'Attitudes towards endorsement of coercive policies',
    q61 = '6.1 Visual of Red light district',
    q62 = '6.2 Visual of Anonymous Patients',
    q63 = '6.3 Visual of Transgenders',
    q64 = '6.4 Visual of Homeless',
    q65 = '6.5 Visual of Injecting Drug Users',
    q66 = '6.6 Visual of Truck drivers',
    q67 = '6.7 Visual of Two men hugging suggestively',
    q68 = '6.8 Visual of Immigrant workers',
    q61_score = 'Score',
    q62_score = 'Score',
    q63_score = 'Score',
    q64_score = 'Score',
    q65_score = 'Score',
    q66_score = 'Score',
    q67_score = 'Score',
    q68_score = 'Score',
    sum6_score ='Total score',
    q71 = '7.1 HIV is unlikely to be transmitted by having sex with PLHIV and using a condom.',
    q72 = '7.2 HIV can be transmitted by having sex with PLHIV without using a condom.',
    q73 = '7.3 HIV can be transmitted by getting an injection with a sterilized syringe and needle.',
    q74 = '7.4 HIV can be transmitted by sharing drug injection needles with PLHIV.',
    q75 = '7.5 HIV can be transmitted by sharing a glass of drinking water with PLHIV.',
    q76 = '7.6 HIV can be transmitted by using a public toilet that was used by PLHIV.',
    q77 = '7.7 HIV can be transmitted by taking the blood pressure PLHIV without using gloves.',
    q78 = '7.8 HIV can be transmitted by getting a needle prick from a sharp object that has been used on PLHIV.',
    q79 = '7.9 HIV can be transmitted by getting HIV-infected blood splashed onto skin with cuts.',
    q71_score = 'Score',
    q72_score = 'Score',
    q73_score = 'Score',
    q74_score = 'Score',
    q75_score = 'Score',
    q76_score = 'Score',
    q77_score = 'Score',
    q78_score = 'Score',
    q79_score = 'Score',
    sum7_score = 'Total score',
    q81 = '8.1 Washing hands before and after treating a patient is a standard precaution.',
    q82 = '8.2 Minimizing contact with bodily fluids by wearing Personal Protective Equipment (PPE) is a standard precaution.',
    q83 = '8.3 Wearing single gloves for procedures that require contact with bodily fluids is a standard precaution.',
    q84 = '8.4 Wearing double gloves for procedures that require contact with bodily fluids is a standard precaution.',
    q85 = '8.5 Sterilizing instruments after use is a standard precaution.',
    q86 = '8.6 Using disposable syringes and needles is a standard precaution.',
    q87 = '8.7 Using bleaching powder/sodium hypochlorite to disinfect soiled linen and contaminated waste exposed to bodily fluids is a standard precaution.',
    q88 = '8.8 Disposing sharp instruments and objects into a specific container is a standard precaution.',
    q89 = '8.9 Separating medical and infectious waste from other waste for disposal is a standard precaution.',
    q810 = '8.10 Being careful handling sharp instruments is a standard precaution.',
    q811 = '8.11 Making the patients dispose of their own hazardous waste is a standard precaution.',
    q81_score = 'Score',
    q82_score = 'Score',
    q83_score = 'Score',
    q84_score = 'Score',
    q85_score = 'Score',
    q86_score = 'Score',
    q87_score = 'Score',
    q88_score = 'Score',
    q89_score = 'Score',
    q810_score = 'Score',
    q811_score = 'Score',
    sum8a_score = 'Total score',
    q812 = '8.12 when they are exposed to body fluids such as blood of patients who have heart disease.',
    q813 = '8.13 when they are exposed to body fluids such as blood of patients who have suspected infections.',
    q814 = '8.14 when they are exposed to body fluids such as blood of patients who have diabetes.',
    q815 = '8.15 when they are exposed to body fluids such as blood of patients who have HIV.',
    q816 = '8.16 when they are exposed to body fluids such as blood of patients who have TB.',
    q812_score = 'Score',
    q813_score = 'Score',
    q814_score = 'Score',
    q815_score = 'Score',
    q816_score = 'Score',
    sum8b_score = 'Total score',
    sum8_score = 'Standard precautions on HIV knowledge',
    q91 = '9.1 Washing hands before and after physically examining a patient will prevent you from becoming infected with HIV when caring for PLHIV.',
    q92 = '9.2 Wearing single gloves when drawing a patient’s blood will prevent you from becoming infected with HIV when caring for PLHIV.',
    q93 = '9.3 Using sterilization equipment such as autoclave on instruments after use will prevent you from becoming infected with HIV when caring for PLHIV.',
    q94 = '9.4 Using disposable syringes and needles will prevent you from becoming infected with HIV when caring for PLHIV.',
    q95 = '9.5 Disposing sharp instruments and objects into a specific container will prevent you from becoming infected with HIV when caring for PLHIV.',
    q96 = '9.6 Separating medical and infectious waste from other waste for disposal will prevent you from becoming infected with HIV when caring for PLHIV.',
    q97 = '9.7 PEP (Post Exposure Prophylaxis) drugs after a needle prick will prevent you from becoming infected with HIV when caring for PLHIV.',
    q91_score = 'Score',
    q92_score = 'Score',
    q93_score = 'Score',
    q94_score = 'Score',
    q95_score = 'Score',
    q96_score = 'Score',
    q97_score = 'Score',
    sum9_score = 'Total score',
    q101 = '10.1 I can notice when someone at my hospital discriminates against PLHIV.',
    q102 = '10.2 I can talk with other students when they make discriminatory comments about PLHIV.',
    q103 = '10.3 I can speak with PLHIV without feeling fear.',
    q104 = '10.4 I can listen to PLHIV without being judgmental.',
    q105 = '10.5 I can touch PLHIV at the hospital without worrying about becoming infected.',
    q106 = '10.6 I can draw blood from PLHIV without becoming infected with HIV.',
    q107 = '10.7 I can dress a wound for PLHIV without becoming infected with HIV.',
    q101_score = 'Score',
    q102_score = 'Score',
    q103_score = 'Score',
    q104_score = 'Score',
    q105_score = 'Score',
    q106_score = 'Score',
    q107_score = 'Score',
    sum10_score = 'Total score'
  )

df3b <- filter(df, q25 == 'Yes')

df14 <- df %>%
  select(
    q3b,
    q12,
    q13b,
    q11,
    qtype,
    qyearf,
    q21,
    q25,
    sum7_score,
    sum8_score,
    sum9_score,
    sum3ai_score,
    sum2a_score) %>%
  drop_na() %>%
  set_variable_labels(
    q21 = 'Have you ever contacted/taken care of HIV patients?',
    q25 = 'Have you ever been tested for HIV?'
  ) %>% 
  set_variable_labels(
    sum7_score = 'HIV knowledge',
    sum9_score = 'Confidence of protective measures',
    sum2a_score = 'Worried about getting HIV infection',
  )

df15 <- df %>%
  select(
    q5a,
    q12,
    qtype,
    qyearf,
    q21,
    q25,
    sum7_score,
    sum8_score) %>%
  drop_na() %>%
  set_variable_labels(
    q21 = 'Have you ever contacted/taken care of HIV patients?',
    q25 = 'Have you ever been tested for HIV?'
  ) %>% 
  set_variable_labels(
    sum7_score = 'HIV knowledge'
  )

n <- nrow(df)
n3b <- nrow(df3b)
n14 <- nrow(df14)
n15 <- nrow(df15)
```

\newpage

### Table 1: Background characteristics of the participants
(n = `r n`)

(For paper 1)
```{r t1a}
tbl_summary(
  df %>% select(-q13a),
  by = qtype,
  include = c(q12, q11, q13b, quniv, qyearf, q25, q21, sum7_score, sum8_score, sum9_score),
  type = list(
    c(q11, sum7_score, sum8_score, sum9_score) ~ 'continuous', 
    q21 ~ "categorical"
  ),
  statistic = list(
    ends_with('_score') ~ "{mean} ({min}, {max})"
  ),
  digits = list(
    q11 ~ c(0, 0, 0),
    ends_with('_score') ~ c(1, 0, 0), 
    all_categorical() ~ c(0, 1)
  ),
  label = list(
    sum7_score = 'HIV knowledge',
    sum9_score = 'Confidence of protective measures'
  )
) %>%
  add_overall() %>%
  add_p(test.args = all_tests("fisher.test") ~ list(workspace = 2e9)) %>%
  bold_labels() %>%
  bold_p() %>%
  modify_header(label ~ '**Background characteristics**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

(For paper 2)
```{r t1b}
tbl_summary(
  df %>% select(-q13b),
  by = qtype,
  include = c(q12, q11, q13a, quniv, qyearf, q25, q21, sum7_score, sum8_score),
  type = list(
    c(q11, sum7_score, sum8_score) ~ 'continuous', 
    q21 ~ "categorical"
  ),
  statistic = list(
    ends_with('_score') ~ "{mean} ({min}, {max})"
  ),
  digits = list(
    q11 ~ c(0, 0, 0),
    ends_with('_score') ~ c(1, 0, 0), 
    all_categorical() ~ c(0, 1)
  ),
  label = list(
    sum7_score = 'HIV knowledge'
  )
) %>%
  add_overall() %>%
  add_p(test.args = all_tests("fisher.test") ~ list(workspace = 2e9)) %>%
  bold_labels() %>%
  bold_p() %>%
  modify_header(label ~ '**Background characteristics**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 2: Contact with people living with HIV
(n = `r n`)

```{r t2}
tbl_summary(
  df,
  by = qtype,
  include = c(q21:q214),
  type = everything() ~ 'categorical',
  digits = list(all_categorical() ~ c(0, 1)),
  missing = 'no',
  label = q21 ~ '2.1 Contact/take care'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p() %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = variable %in% c('q211', 'q212', 'q213', 'q214')) %>%
  modify_column_indent(columns = label,
                       rows = variable %in% c('q211', 'q212', 'q213', 'q214') & row_type == 'level',
                       double_indent = TRUE) %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 3A: Worried about getting HIV infection
(n = `r n`)

```{r t3a}
tbl_summary(
  df,
  by = qtype,
  include = c(q221, q221_score, q231, q231_score, q241, q241_score, sum2a_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**How worried ...**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>% 
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')

```

\newpage

### Table 3B: Worried about being treated differently or discriminated
(n = `r n3b`)

```{r t3b}
tbl_summary(
  df3b,
  by = qtype,
  include = c(q26, q26_score, q27, q27_score, sum2b_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**How worried ...**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>% 
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')

```

\newpage

### Table 4: Professional behaviors - Q3a: How worried
(n = `r n`)

```{r t4}
tbl_summary(
  df,
  by = qtype,
  include = c(q311,q311_score,q321,q321_score,q331,q331_score,q341,q341_score,q351,q351_score,q361,q361_score,q371,q371_score,q381,q381_score,q391,q391_score,q3101,q3101_score,sum3a_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**How worried when ….**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 5: Professional behaviors - Q3b: Intent to discriminate
(n = `r n`)

```{r t5}
tbl_summary(
  df,
  by = qtype,
  include = c(q312,q312_score,q322,q322_score,q332,q332_score,q342,q342_score,q352,q352_score,q362,q362_score,q372,q372_score,q382,q382_score,q392,q392_score,q3102,q3102_score,sum3b_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**Intent to discriminate when ….**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 6: Professional community norms
(n = `r n`)

```{r t6}
tbl_summary(
  df,
  by = qtype,
  include = c(q42, q42_score,
              q43, q43_score,
              q44, q44_score,
              q45, q45_score,
              q46, q46_score,
              q47, q47_score,
              sum4_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 7A: Healthcare policies
(n = `r n`)

```{r t7a}
tbl_summary(
  df,
  by = qtype,
  include = c(q51,q51_score,
              q52,q52_score,
              q53,q53_score,
              q54,q54_score,
              q55,q55_score,
              q56,q56_score,
              q57,q57_score,
              q58,q58_score,
              q59,q59_score,
              q510,q510_score,
              q511,q511_score,
              q512,q512_score,
              q513,q513_score,
              q514,q514_score,
              q515,q515_score,
              q516,q516_score,
              q517,q517_score,
              q518,q518_score,
              q519,q519_score,
              sum5a_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')

tbl_summary(
  df,
  by = qtype,
  include = c(q51_2:q519_2),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 7B: Healthcare policies
(n = `r n`)

```{r t7b}
tbl_summary(
  df,
  by = qtype,
  include = c(q520,q520_score,
              q521,q521_score,
              q522,q522_score,
              q523,q523_score,
              sum5b_score),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')

tbl_summary(
  df,
  by = qtype,
  include = c(q520_2:q523_2),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 8: Caring for different populations
(n = `r n`)

```{r t8}
tbl_summary(
  df,
  by = qtype,
  include = c(
    q61,q61_score,
    q62,q62_score,
    q63,q63_score,
    q64,q64_score,
    q65,q65_score,
    q66,q66_score,
    q67,q67_score,
    q68,q68_score,
    sum6_score
  ),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1), all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**How comfortable would you be caring for people, like those seen in this picture, in the hospital? …**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 10: HIV Transmission
(n = `r n`)

```{r t10}
tbl_summary(
  df,
  by = qtype,
  include = c(
    q71,q71_score,
    q72,q72_score,
    q73,q73_score,
    q74,q74_score,
    q75,q75_score,
    q76,q76_score,
    q77,q77_score,
    q78,q78_score,
    q79,q79_score,
    sum7_score
  ),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1), all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 11A: Standard precaution knowledge
(n = `r n`)

```{r t11a}
tbl_summary(
  df,
  by = qtype,
  include = c(
    q81,q81_score,
    q82,q82_score,
    q83,q83_score,
    q84,q84_score,
    q85,q85_score,
    q86,q86_score,
    q87,q87_score,
    q88,q88_score,
    q89,q89_score,
    q810,q810_score,
    q811,q811_score,
    sum8a_score
  ),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 11B: Standard precaution knowledge
(n = `r n`)

```{r t11b}
tbl_summary(
  df,
  by = qtype,
  include = c(
    q812,q812_score,
    q813,q813_score,
    q814,q814_score,
    q815,q815_score,
    q816,q816_score,
    sum8b_score
  ),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**How important is it for healthcare workers to follow standard precautions …**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 12: Protective measures
(n = `r n`)

```{r t12}
tbl_summary(
  df,
  by = qtype,
  include = c(
    q91,q91_score,
    q92,q92_score,
    q93,q93_score,
    q94,q94_score,
    q95,q95_score,
    q96,q96_score,
    q97,q97_score,
    sum9_score
  ),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 13: Confidence
(n = `r n`)

```{r t13}
tbl_summary(
  df,
  by = qtype,
  include = c(
    q101,q101_score,
    q102,q102_score,
    q103,q103_score,
    q104,q104_score,
    q105,q105_score,
    q106,q106_score,
    q107,q107_score,
    sum10_score
  ),
  type = ends_with('_score') ~ 'continuous',
  statistic = ends_with('_score') ~ 'Sum:{sum} Mean:{mean} (±{sd})',
  digits = list(all_categorical() ~ c(0, 1),
                all_continuous() ~ c(0, 1, 1)),
  missing = 'no'
) %>%
  add_overall() %>%
  bold_labels() %>%
  add_p(ends_with('_score') ~ "t.test") %>%
  bold_p() %>%
  modify_header(label ~ '**How confident are you that you can carry out each one of these behaviors ….**',
                all_stat_cols() ~ "**{level}**<br>N = {n}") %>%
  modify_column_indent(columns = label,
                       rows = var_label == 'Score') %>%
  as_gt() %>%
  tab_options(table.border.bottom.style = 'none')
```

\newpage

### Table 14: Factor associated with intention to discriminate while performing invasive procedures
(n = `r n14`)

```{r t14}
t_stat <- tbl_summary(
  df14,
  by = q3b,
  type = list(c('q11', ends_with('_score')) ~ 'continuous',
              q21 ~ 'categorical'),
  statistic = list(all_continuous() ~ "{mean} ({min}, {max})"),
  digits = list(all_continuous() ~ c(1, 0, 0)),
) %>%
  add_overall() %>%
  bold_labels() %>%
  modify_header(all_stat_cols() ~ "**{level}**<br>N = {n}")

t_uni <- df14 %>%
  tbl_uvregression(                         # produce univariate table
    method = glm,                           # generalised linear model
    y = q3b,                                # define outcome variable
    method.args = list(family = binomial),  # arguments for glm
    exponentiate = TRUE,                    # exponentiate to produce OR
    hide_n = TRUE                           # hide N column
  ) %>%
  add_global_p() %>%                        # show global p instead
  bold_p(0.2)

fullmodel <- glm(
  q3b ~ q12 + qyearf + sum7_score + sum9_score + sum3ai_score + sum2a_score,
  family = "binomial",
  data = df14
)
# summary(fullmodel)

nullmodel <- glm(
  q3b ~ 1,
  family = "binomial",
  data = df14
)
# summary(nullmodel)

model1 <- glm(
  q3b ~ q12 + qyearf + sum7_score + sum3ai_score + sum2a_score,
  family = "binomial",
  data = df14
)
# lrtest(fullmodel, model1)
# summary(model1)

model2 <- glm(
  q3b ~ qyearf + sum7_score + sum3ai_score + sum2a_score,
  family = "binomial",
  data = df14
)
# lrtest(model1, model2)
# summary(model2)

model3 <- glm(
  q3b ~ qyearf + sum7_score + sum3ai_score,
  family = "binomial",
  data = df14
)
# lrtest(model2, model3)
# summary(model3)

m1 <- step(fullmodel, direction = "backward", trace = FALSE)
m2 <- step(nullmodel, direction = "forward", trace = FALSE,
           scope = list(upper = fullmodel, lower = nullmodel))
m3 <- step(fullmodel, direction="both", trace = FALSE,
           scope = list(upper = fullmodel, lower = nullmodel))
m4 <- step(nullmodel, direction="both", trace = FALSE,
           scope = list(upper = fullmodel, lower = nullmodel))
# lrtest(m1, m2)
# lrtest(m1, m3)
# lrtest(m1, m4)
# summary(m1)

t_multi <- tbl_regression(m1, exponentiate = TRUE) %>%
  add_global_p() %>%                        # show global p instead
  bold_p(0.05)

tbl_merge(
  list(t_stat, t_uni, t_multi),
  tab_spanner = c('Intention to discriminate', 'Univariate', 'Multivariate')
) %>%
  as_gt() %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_column_spanners())
```

\newpage

### Table 15: Factors associated with students attitudes towards endorsement of coercive policies related to HIV stigma (q5.1 - q5.19)
(n = `r n15`)

```{r t15}
t_stat <- tbl_summary(
  df15,
  by = q5a,
  type = list(c(ends_with('_score')) ~ 'continuous',
              q21 ~ 'categorical'),
  statistic = list(all_continuous() ~ "{mean} ({min}, {max})"),
  digits = list(all_continuous() ~ c(1, 0, 0)),
) %>%
  add_overall() %>%
  bold_labels() %>%
  modify_header(all_stat_cols() ~ "**{level}**<br>N = {n}")

t_uni <- df15 %>%
  tbl_uvregression(                         # produce univariate table
    method = glm,                           # generalised linear model
    y = q5a,                                # define outcome variable
    method.args = list(family = binomial),  # arguments for glm
    exponentiate = TRUE,                    # exponentiate to produce OR
    hide_n = TRUE                           # hide N column
  ) %>%
  add_global_p() %>%                        # show global p instead
  bold_p(0.2)

fullmodel <- glm(
  q5a ~ qtype + q21 + sum7_score + sum8_score,
  family = "binomial",
  data = df15
)
# summary(fullmodel)

nullmodel <- glm(
  q5a ~ 1,
  family = "binomial",
  data = df15
)
# summary(nullmodel)

model1 <- glm(
  q5a ~ qtype + q21 + sum7_score,
  family = "binomial",
  data = df15
)
# lrtest(fullmodel, model1)
# summary(model1)

m1 <- step(fullmodel, direction = "backward", trace = FALSE)
m2 <- step(nullmodel, direction = "forward", trace = FALSE,
           scope = list(upper = fullmodel, lower = nullmodel))
m3 <- step(fullmodel, direction="both", trace = FALSE,
           scope = list(upper = fullmodel, lower = nullmodel))
m4 <- step(nullmodel, direction="both", trace = FALSE,
           scope = list(upper = fullmodel, lower = nullmodel))
# lrtest(m1, m2)
# lrtest(m1, m3)
# lrtest(m1, m4)
# summary(m1)

t_multi <- tbl_regression(m1, exponentiate = TRUE) %>%
  add_global_p() %>%                        # show global p instead
  bold_p(0.05)

tbl_merge(
  list(t_stat, t_uni, t_multi),
  tab_spanner = c('Attitude', 'Univariate', 'Multivariate')
) %>%
  as_gt() %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_column_spanners())
```

```{r alpha, include = FALSE}
psych::alpha(select(df, q311_score:q3101_score))
psych::alpha(select(df, q312_score:q3102_score))
psych::alpha(select(df, q312_score2:q3102_score2))

psych::alpha(select(df, q42_score:q47_score))
psych::alpha(select(df, q43_score:q47_score))

psych::alpha(select(df, matches("^q5([1-9]|1[0-9]|2[0-3])_score$")))
psych::alpha(select(df, matches("^q5([1-9]|1[0-9])_score$")))
psych::alpha(select(df, matches("^q5(2[0-3])_score$")))

psych::alpha(select(df, c(q61_score:q68_score)))

psych::alpha(select(df, matches("^q7([1-9])_score$")))

psych::alpha(select(df, c(matches("^q8([1-9]|1[0-1])_score$"))))
psych::alpha(select(df, c(q812_score:q816_score)))

psych::alpha(select(df, c(q91_score:q97_score)))

psych::alpha(select(df, c(q101_score:q107_score)))
```